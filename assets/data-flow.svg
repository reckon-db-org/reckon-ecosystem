<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 680" fill="none">
  <defs>
    <linearGradient id="bgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#0f172a"/>
      <stop offset="100%" style="stop-color:#1e293b"/>
    </linearGradient>
    <linearGradient id="appGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#7c3aed"/>
      <stop offset="100%" style="stop-color:#5b21b6"/>
    </linearGradient>
    <linearGradient id="evoqGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#10b981"/>
      <stop offset="100%" style="stop-color:#059669"/>
    </linearGradient>
    <linearGradient id="adapterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#ec4899"/>
      <stop offset="100%" style="stop-color:#be185d"/>
    </linearGradient>
    <linearGradient id="gaterGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#0ea5e9"/>
      <stop offset="100%" style="stop-color:#0284c7"/>
    </linearGradient>
    <linearGradient id="storeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#6366f1"/>
      <stop offset="100%" style="stop-color:#4338ca"/>
    </linearGradient>
    <linearGradient id="prjGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f59e0b"/>
      <stop offset="100%" style="stop-color:#d97706"/>
    </linearGradient>
    <linearGradient id="readGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#64748b"/>
      <stop offset="100%" style="stop-color:#475569"/>
    </linearGradient>

    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="0" dy="3" stdDeviation="6" flood-color="#000" flood-opacity="0.3"/>
    </filter>

    <marker id="arrowW" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#e2e8f0"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="1200" height="680" fill="url(#bgGrad)"/>
  <g opacity="0.06">
    <pattern id="grid2" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#fff" stroke-width="0.5"/>
    </pattern>
    <rect width="1200" height="680" fill="url(#grid2)"/>
  </g>

  <!-- Title -->
  <text x="600" y="45" text-anchor="middle" font-family="system-ui, sans-serif" font-size="28" font-weight="bold" fill="#fff">
    Data Flow Through the Reckon Stack
  </text>
  <text x="600" y="70" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" fill="#94a3b8">
    Write side (commands) and read side (projections) — each package as a distinct step
  </text>

  <!-- ============================================ -->
  <!-- ROW 1: WRITE SIDE                            -->
  <!-- CMD app → evoq(cmd) → evoq(event) → reckon_evoq → reckon_gater → reckon_db -->
  <!-- ============================================ -->

  <!-- Write side label -->
  <rect x="40" y="100" width="120" height="26" rx="13" fill="#7c3aed" opacity="0.3"/>
  <text x="100" y="118" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#a78bfa">WRITE SIDE</text>

  <!-- Step 1: CMD Application -->
  <g filter="url(#shadow)">
    <rect x="40" y="140" width="160" height="110" rx="10" fill="url(#appGrad)"/>
    <text x="120" y="168" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#c4b5fd">CMD APPLICATION</text>
    <text x="120" y="193" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Your App</text>
    <text x="120" y="214" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#e9d5ff">Dispatches command</text>
    <text x="120" y="240" text-anchor="middle" font-family="monospace" font-size="9" fill="#a78bfa">dispatch(Cmd)</text>
  </g>

  <!-- Arrow 1→2 -->
  <line x1="200" y1="195" x2="228" y2="195" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 2: evoq (Command) -->
  <g filter="url(#shadow)">
    <rect x="230" y="140" width="160" height="110" rx="10" fill="url(#evoqGrad)"/>
    <text x="310" y="168" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#a7f3d0">evoq</text>
    <text x="310" y="193" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Command</text>
    <text x="310" y="214" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a7f3d0">Aggregate validates</text>
    <text x="310" y="228" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a7f3d0">and produces events</text>
    <text x="310" y="244" text-anchor="middle" font-family="monospace" font-size="9" fill="#6ee7b7">execute(State, Cmd)</text>
  </g>

  <!-- Arrow 2→3 -->
  <line x1="390" y1="195" x2="418" y2="195" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 3: evoq (Event) -->
  <g filter="url(#shadow)">
    <rect x="420" y="140" width="160" height="110" rx="10" fill="url(#evoqGrad)"/>
    <text x="500" y="168" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#a7f3d0">evoq</text>
    <text x="500" y="193" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Event</text>
    <text x="500" y="214" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a7f3d0">Domain event in</text>
    <text x="500" y="228" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a7f3d0">evoq_event envelope</text>
    <text x="500" y="244" text-anchor="middle" font-family="monospace" font-size="9" fill="#6ee7b7">apply(State, Event)</text>
  </g>

  <!-- Arrow 3→4 -->
  <line x1="580" y1="195" x2="608" y2="195" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 4: reckon_evoq (Adapter) -->
  <g filter="url(#shadow)">
    <rect x="610" y="140" width="160" height="110" rx="10" fill="url(#adapterGrad)"/>
    <text x="690" y="168" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#fce7f3">reckon_evoq</text>
    <text x="690" y="193" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Adapter</text>
    <text x="690" y="214" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#fce7f3">Translates evoq events</text>
    <text x="690" y="228" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#fce7f3">to store operations</text>
  </g>

  <!-- Arrow 4→5 -->
  <line x1="770" y1="195" x2="798" y2="195" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 5: reckon_gater (API) -->
  <g filter="url(#shadow)">
    <rect x="800" y="140" width="160" height="110" rx="10" fill="url(#gaterGrad)"/>
    <text x="880" y="168" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#bae6fd">reckon_gater</text>
    <text x="880" y="193" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">API</text>
    <text x="880" y="214" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#bae6fd">Store interface and</text>
    <text x="880" y="228" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#bae6fd">canonical record types</text>
  </g>

  <!-- Arrow 5→6 -->
  <line x1="960" y1="195" x2="988" y2="195" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 6: reckon_db (Event Store) -->
  <g filter="url(#shadow)">
    <rect x="990" y="140" width="170" height="110" rx="10" fill="url(#storeGrad)"/>
    <text x="1075" y="168" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#c7d2fe">reckon_db</text>
    <text x="1075" y="193" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Event Store</text>
    <text x="1075" y="214" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#c7d2fe">Append to stream</text>
    <text x="1075" y="228" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#c7d2fe">Khepri/Ra consensus</text>
  </g>

  <!-- ============================================ -->
  <!-- SEPARATOR                                    -->
  <!-- ============================================ -->

  <line x1="40" y1="290" x2="1160" y2="290" stroke="#475569" stroke-width="1" stroke-dasharray="8,4" opacity="0.5"/>

  <!-- ============================================ -->
  <!-- ROW 2: PROJECTION SIDE                       -->
  <!-- reckon_db → reckon_evoq → evoq(event) → PRJ app → storage -->
  <!-- ============================================ -->

  <!-- Projection side label -->
  <rect x="40" y="310" width="150" height="26" rx="13" fill="#f59e0b" opacity="0.3"/>
  <text x="115" y="328" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#fbbf24">PROJECTIONS</text>

  <!-- Step 1: reckon_db (subscription) -->
  <g filter="url(#shadow)">
    <rect x="40" y="350" width="170" height="110" rx="10" fill="url(#storeGrad)"/>
    <text x="125" y="378" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#c7d2fe">reckon_db</text>
    <text x="125" y="403" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Event Store</text>
    <text x="125" y="424" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#c7d2fe">Subscription delivers</text>
    <text x="125" y="438" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#c7d2fe">events to consumers</text>
    <text x="125" y="454" text-anchor="middle" font-family="monospace" font-size="9" fill="#a5b4fc">catch_up + live</text>
  </g>

  <!-- Arrow 1→2 -->
  <line x1="210" y1="405" x2="248" y2="405" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 2: reckon_evoq (Adapter) -->
  <g filter="url(#shadow)">
    <rect x="250" y="350" width="170" height="110" rx="10" fill="url(#adapterGrad)"/>
    <text x="335" y="378" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#fce7f3">reckon_evoq</text>
    <text x="335" y="403" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Adapter</text>
    <text x="335" y="424" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#fce7f3">Translates store events</text>
    <text x="335" y="438" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#fce7f3">to evoq format</text>
  </g>

  <!-- Arrow 2→3 -->
  <line x1="420" y1="405" x2="458" y2="405" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 3: evoq (Event delivery) -->
  <g filter="url(#shadow)">
    <rect x="460" y="350" width="170" height="110" rx="10" fill="url(#evoqGrad)"/>
    <text x="545" y="378" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#a7f3d0">evoq</text>
    <text x="545" y="403" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Event</text>
    <text x="545" y="424" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a7f3d0">evoq_event envelope</text>
    <text x="545" y="438" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a7f3d0">delivered to projection</text>
  </g>

  <!-- Arrow 3→4 -->
  <line x1="630" y1="405" x2="668" y2="405" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 4: PRJ Application -->
  <g filter="url(#shadow)">
    <rect x="670" y="350" width="170" height="110" rx="10" fill="url(#prjGrad)"/>
    <text x="755" y="378" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#fef3c7">PRJ APPLICATION</text>
    <text x="755" y="403" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Projection</text>
    <text x="755" y="424" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#fef3c7">Transforms events into</text>
    <text x="755" y="438" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#fef3c7">optimized read models</text>
    <text x="755" y="454" text-anchor="middle" font-family="monospace" font-size="9" fill="#fde68a">handle_event(Event)</text>
  </g>

  <!-- Arrow 4→5 -->
  <line x1="840" y1="405" x2="878" y2="405" stroke="#e2e8f0" stroke-width="2" opacity="0.6" marker-end="url(#arrowW)"/>

  <!-- Step 5: Storage (Read Model) -->
  <g filter="url(#shadow)">
    <rect x="880" y="350" width="170" height="110" rx="10" fill="url(#readGrad)"/>
    <text x="965" y="378" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" font-weight="600" fill="#e2e8f0">STORAGE</text>
    <text x="965" y="403" text-anchor="middle" font-family="system-ui, sans-serif" font-size="14" font-weight="bold" fill="#fff">Read Model</text>
    <text x="965" y="424" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#cbd5e1">SQLite / ETS</text>
    <text x="965" y="438" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#cbd5e1">Denormalized, query-ready</text>
    <text x="965" y="454" text-anchor="middle" font-family="monospace" font-size="9" fill="#94a3b8">No joins, no calcs</text>
  </g>

  <!-- ============================================ -->
  <!-- VERTICAL CONNECTION: store links both rows   -->
  <!-- ============================================ -->

  <!-- Dashed line connecting reckon_db in write row to reckon_db in projection row -->
  <path d="M 1075 250 L 1075 290 Q 1075 310 1050 320 L 145 320 Q 125 320 125 340 L 125 350"
        stroke="#a5b4fc" stroke-width="2" opacity="0.35" stroke-dasharray="6,3"/>
  <text x="600" y="285" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">
    events persisted above flow down via subscriptions
  </text>

  <!-- ============================================ -->
  <!-- LEGEND                                       -->
  <!-- ============================================ -->

  <g transform="translate(40, 500)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="13" font-weight="600" fill="#94a3b8">Package Legend</text>

    <rect x="0" y="18" width="14" height="14" rx="3" fill="#7c3aed"/>
    <text x="22" y="29" font-family="system-ui, sans-serif" font-size="11" fill="#a78bfa">Your CMD / PRJ application code</text>

    <rect x="260" y="18" width="14" height="14" rx="3" fill="#10b981"/>
    <text x="282" y="29" font-family="system-ui, sans-serif" font-size="11" fill="#34d399">evoq — CQRS framework (commands, events, projections)</text>

    <rect x="0" y="42" width="14" height="14" rx="3" fill="#ec4899"/>
    <text x="22" y="53" font-family="system-ui, sans-serif" font-size="11" fill="#f472b6">reckon_evoq — Adapter (bridges evoq to reckon_db)</text>

    <rect x="430" y="42" width="14" height="14" rx="3" fill="#0ea5e9"/>
    <text x="452" y="53" font-family="system-ui, sans-serif" font-size="11" fill="#38bdf8">reckon_gater — Store API &amp; shared types</text>

    <rect x="0" y="66" width="14" height="14" rx="3" fill="#6366f1"/>
    <text x="22" y="77" font-family="system-ui, sans-serif" font-size="11" fill="#818cf8">reckon_db — Event store (Khepri/Ra)</text>

    <rect x="260" y="66" width="14" height="14" rx="3" fill="#64748b"/>
    <text x="282" y="77" font-family="system-ui, sans-serif" font-size="11" fill="#94a3b8">Read model storage (SQLite, ETS, etc.)</text>
  </g>

  <!-- Key insight -->
  <g transform="translate(40, 610)">
    <text x="0" y="0" font-family="system-ui, sans-serif" font-size="11" fill="#64748b">
      Write: CMD App &#x2192; evoq (command) &#x2192; evoq (event) &#x2192; reckon_evoq &#x2192; reckon_gater &#x2192; reckon_db
    </text>
    <text x="0" y="18" font-family="system-ui, sans-serif" font-size="11" fill="#64748b">
      Read: reckon_db &#x2192; reckon_evoq &#x2192; evoq (event) &#x2192; PRJ App &#x2192; Storage (read model)
    </text>
  </g>

  <!-- Version -->
  <text x="1160" y="668" text-anchor="end" font-family="system-ui, sans-serif" font-size="10" fill="#475569">
    reckon_ecosystem v0.1.0
  </text>
</svg>
